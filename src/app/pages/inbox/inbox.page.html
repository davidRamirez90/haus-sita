<section class="inbox">
  <header class="page-header">
    <div>
      <p class="eyebrow">Gedankenablage</p>
      <h1>Eingang</h1>
    </div>
    <div class="hint">Aufgaben erfassen und fehlende Details sofort sichtbar machen.</div>
  </header>

  <a class="new-task-button" [routerLink]="'/tasks/new'" [queryParams]="{ returnUrl: '/inbox' }">Neue Aufgabe</a>

  @if (error()) {
    <div class="message">{{ error() }}</div>
  }

  @if (loading()) {
    <div class="message">Wird geladen…</div>
  }

  @if (!loading()) {
    @let sections = triageSections();

    <div class="triage">
      <section class="triage-section" aria-label="Unassigned tasks">
        <div class="section-header">
          <h2>Unassigned</h2>
          <p class="section-hint">Weise eine verantwortliche Person zu.</p>
        </div>

        <div class="list">
          @for (task of sections.unassigned; track task.id) {
            <app-task-card
              [task]="task"
              [priorities]="taskPriorities()[task.id] ?? []"
              [users]="users()"
              (taskUpdated)="handleTaskUpdated($event)"
              class="task-item"
            ></app-task-card>
          }

          @if (!sections.unassigned.length) {
            <div class="empty">Alle Aufgaben haben eine Zuordnung.</div>
          }
        </div>
      </section>

      <section class="triage-section" aria-label="Missing scheduling">
        <div class="section-header">
          <h2>Fehlendes Timing</h2>
          <p class="section-hint">Lege Zeitmodus und Datum fest.</p>
        </div>

        <div class="list">
          @for (task of sections.missingScheduling; track task.id) {
            <app-task-card
              [task]="task"
              [priorities]="taskPriorities()[task.id] ?? []"
              [users]="users()"
              (taskUpdated)="handleTaskUpdated($event)"
              class="task-item"
            ></app-task-card>
          }

          @if (!sections.missingScheduling.length) {
            <div class="empty">Alle Aufgaben sind zeitlich verortet.</div>
          }
        </div>
      </section>

      <section class="triage-section" aria-label="Missing category">
        <div class="section-header">
          <h2>Keine Kategorie</h2>
          <p class="section-hint">Ordne einen Raum oder Bereich zu.</p>
        </div>

        <div class="list">
          @for (task of sections.missingCategory; track task.id) {
            <app-task-card
              [task]="task"
              [priorities]="taskPriorities()[task.id] ?? []"
              [users]="users()"
              (taskUpdated)="handleTaskUpdated($event)"
              class="task-item"
            ></app-task-card>
          }

          @if (!sections.missingCategory.length) {
            <div class="empty">Alle Aufgaben haben eine Kategorie.</div>
          }
        </div>
      </section>

      <section class="triage-section" aria-label="Ready for planning">
        <div class="section-header">
          <h2>Bereit für Planung</h2>
          <p class="section-hint">Alle Pflichtangaben sind hinterlegt.</p>
        </div>

        <div class="list">
          @for (task of sections.ready; track task.id) {
            <app-task-card
              [task]="task"
              [priorities]="taskPriorities()[task.id] ?? []"
              [users]="users()"
              (taskUpdated)="handleTaskUpdated($event)"
              class="task-item"
            ></app-task-card>
          }

          @if (!sections.ready.length) {
            <div class="empty">Alles ist vorbereitet. Plane die nächsten Schritte.</div>
          }
        </div>
      </section>
    </div>
  }
</section>
